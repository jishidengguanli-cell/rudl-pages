<!doctype html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>註冊 - RU Download</title>
<style>
  body{margin:0;background:#0f172a;color:#e5e7eb;font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
  .wrap{max-width:420px;margin:60px auto;padding:0 16px}
  .card{background:#111827;border:1px solid #1f2937;border-radius:16px;padding:24px}
  label{display:block;margin:10px 0 4px;color:#9ca3af}
  input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #334155;background:#0b1222;color:#e5e7eb}
  button{width:100%;padding:12px;border-radius:10px;border:0;background:#10b981;color:#0b1222;margin-top:16px;font-weight:700}
  a{color:#93c5fd;text-decoration:none}
  .err{color:#fca5a5;margin-top:8px;min-height:20px}
</style>

<div class="wrap">
  <div class="card">
    <h2 style="margin-top:0">建立帳號</h2>
    <label>Email</label>
    <input id="email" type="email" placeholder="you@example.com" />
    <label>密碼</label>
    <input id="pw" type="password" placeholder="至少 8 碼" />
    <div class="err" id="err"></div>
    <button id="btn">註冊</button>
    <p style="text-align:center;margin:12px 0 0">已有帳號？<a href="/login.html">去登入</a></p>
  </div>
</div>

<!-- 先載入共用工具 -->
<script src="/app.js"></script>
<!-- 再掛事件處理（放在 body 最底，確保 DOM 已建立） -->
<script>
const email = qs('email');
const pw = qs('pw');
const btn = qs('btn');
const err = qs('err');

btn.addEventListener('click', async () => {
  err.textContent = '';
  const em = (email.value || '').trim();
  const pwd = pw.value || '';
  if (!em || !pwd) { err.textContent = '請輸入 Email 與密碼'; return; }
  if (pwd.length < 8) { err.textContent = '密碼至少 8 碼'; return; }

  setBtnLoading(btn, true);
  const { status, data } = await postJSON('/api/auth/register', { email: em, password: pwd });
  setBtnLoading(btn, false);

  if (status === 201) {
    location.href = '/dashboard.html';
  } else if (status === 409) {
    err.textContent = '這個 Email 已被註冊';
  } else {
    err.textContent = data?.error || '發生錯誤，稍後再試';
  }
});
</script>
