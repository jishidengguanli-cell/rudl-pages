<!doctype html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>控制台 - RU Download</title>
<style>
  body{margin:0;background:#0f172a;color:#e5e7eb;font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
  header{background:#0b1222;border-bottom:1px solid #1f2937}
  .wrap{max-width:980px;margin:0 auto;padding:16px}
  nav{display:flex;align-items:center;gap:12px}
  nav .right{margin-left:auto;display:flex;gap:10px}
  a{color:#93c5fd;text-decoration:none}
  .btn{padding:8px 12px;border-radius:10px;border:0;background:#ef4444;color:#fff;cursor:pointer}
  .card{background:#111827;border:1px solid #1f2937;border-radius:16px;padding:24px;margin-top:20px}
  .muted{color:#9ca3af}
</style>

<header>
  <div class="wrap">
    <nav>
      <strong>控制台</strong>
      <div class="right">
        <a href="/dashboard.html">分發列表</a>
        <a href="#" id="logout">登出</a>
      </div>
    </nav>
  </div>
</header>

<main class="wrap">
  <div class="card">
    <h2 style="margin-top:0">歡迎！</h2>
    <p id="me" class="muted">讀取中…</p>
    <p class="muted">下一步我們會在這裡加入「分發列表」與「新增分發」。</p>
  </div>
</main>

<script>
// 載入即檢查登入，未登入導回 login.html?next=/dashboard.html
(async () => {
  try {
    const r = await fetch("/api/auth/me", { credentials: "same-origin" });
    const me = await r.json();
    if (!me.authenticated) {
      location.href = "/login.html?next=/dashboard.html";
      return;
    }
    document.getElementById("me").textContent = `目前登入：${me.email}`;
  } catch (e) {
    location.href = "/login.html?next=/dashboard.html";
  }
})();

// 「登出」一定綁事件＋阻止預設跳轉
document.getElementById("logout").addEventListener("click", async (e) => {
  e.preventDefault();
  try {
    await fetch("/api/auth/logout", { method: "POST", credentials: "same-origin" });
  } catch {}
  location.href = "/login.html";
});
</script>
