<!doctype html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>登入 - RU Download</title>
<style>
  body{margin:0;background:#0f172a;color:#e5e7eb;font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
  .wrap{max-width:420px;margin:60px auto;padding:0 16px}
  .card{background:#111827;border:1px solid #1f2937;border-radius:16px;padding:24px}
  label{display:block;margin:10px 0 4px;color:#9ca3af}
  input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #334155;background:#0b1222;color:#e5e7eb}
  button{width:100%;padding:12px;border-radius:10px;border:0;background:#3b82f6;color:#fff;margin-top:16px;font-weight:600}
  a{color:#93c5fd;text-decoration:none}
  .err{color:#fca5a5;margin-top:8px;min-height:20px}
</style>

<div class="wrap">
  <div class="card">
    <h2 style="margin-top:0">登入</h2>
    <label>Email</label>
    <input id="email" type="email" placeholder="you@example.com" />
    <label>密碼</label>
    <input id="pw" type="password" placeholder="至少 8 碼" />
    <div class="err" id="err"></div>
    <button id="btn">登入</button>
    <p style="text-align:center;margin:12px 0 0">沒有帳號？<a href="/register.html">去註冊</a></p>
  </div>
</div>

<script>
document.getElementById('btn').onclick = async () => {
  // 第 1 步我們先不送 API，只做跳轉；第 2 步再接上 /api/auth/login
  location.href = "/dashboard.html";
};
<script src="/app.js"></script>
<script>
const email = qs('email');
const pw = qs('pw');
const btn = qs('btn');
const err = qs('err');

btn.onclick = async () => {
  err.textContent = '';
  const em = (email.value || '').trim();
  const pwd = pw.value || '';
  if (!em || !pwd) { err.textContent = '請輸入 Email 與密碼'; return; }

  setBtnLoading(btn, true);
  const { status, data } = await postJSON('/api/auth/login', { email: em, password: pwd });
  setBtnLoading(btn, false);

  if (status === 200) {
    const next = new URLSearchParams(location.search).get('next') || '/dashboard.html';
    location.href = next;
  } else if (status === 401) {
    err.textContent = '帳號或密碼不正確';
  } else {
    err.textContent = data?.error || '發生錯誤，稍後再試';
  }
};
</script>
